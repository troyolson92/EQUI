@*set title*@
@{
    ViewBag.Title = "PloegRapport";
}

<div id="PloegRapportGridSpincontainer" style="position:relative">
    <div id="PloegRapportGrid" class="mvc-grid"></div>
</div>

@*render popuover modal*@
<div id="MyModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class='card-body'><i class='fa fa-spinner fa-pulse fa-4x fa-fw text-white'></i><span class='sr-only'>Loading...</span></div>
</div>

@section scripts{
    <!--ploegrapport script-->
    <script type="text/javascript">
    var PloegRapportGridspinner = new Spinner();
    //render grid and subscrible to row clicked events
        $('#PloegRapportGrid').mvcgrid({
            sourceUrl: '@Url.Action("_ploegRapport")', // Grid source url string
            requestType: 'get', // Ajax grid request type
            reload: true, // Grid reload indicator
            rowClicked: function (row, data, e) {
                var urlMoreInfo = '@Url.Action("_Moreinfo","Table")?location=' + encodeURIComponent(data.Location)
                    + '&errornum=' + encodeURIComponent(data.Logcode)
                    + '&refid=' + encodeURIComponent(data.refId)
                    + '&logtype=' + encodeURIComponent(data.Logtype)
                    + '&logtext=' + encodeURIComponent(data.logtext)
                //launch modal
                $('#MyModal').removeData('bs.modal');
                $('#MyModal').modal({ show: true });
                $('#MyModal').load(urlMoreInfo, function (result) {});
            },
            reloadStarted: function () {
                PloegRapportGridspinner.spin(document.getElementById('PloegRapportGridSpincontainer'));
            },
            reloadEnded: function () {
                PloegRapportGridspinner.stop();
            },
            reloadFailed: function (result) {
                console.log(result);
                PloegRapportGridspinner.stop();
                $("#PloegRapportGrid").html("<div class='alert alert-danger'>Error while loading!! </div>");
            }
        });

        //on modal close
        $('#MyModal').on('hidden.bs.modal', function (e) {
            $('#MyModal').html("<div class='card-body'><i class='fa fa-spinner fa-pulse fa-4x fa-fw text-white' ></i ><span class='sr-only'>Loading...</span></div >");
        });

        //full with screen
        $("#allcontent").removeClass("body-content");
        $("#allcontent").removeClass("container");
    </script>

    <!--Handle signal R reload-->
    <script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
    <script src="~/signalr/js"></script>
    <script>
        $.connection.hub.start()
            .done(function () {
                console.log("PloegRapport SignalR connected");
                $.connection.dataRefreshHub.server.joinGroup("Ploegrapport");
            })
            .fail(function () { console.log("PloegRapport SignalR connect ERROR") });

        //trigger full window reload
        $.connection.dataRefreshHub.client.newData = function () {
            console.log("PloegRapportGrid reload");
            $('#PloegRapport').mvcgrid({
                reload: true
            });
        }
    </script>
}
